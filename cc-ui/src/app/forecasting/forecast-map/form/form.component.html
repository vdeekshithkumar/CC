<div class="popover-card2">
  <!-- Header Section -->
  <div class="popover-header" *ngIf="!isSurplusAreaSelected && !isDeficitAreaSelected">
    <div class="header-title">Port Summary</div>
    <div class="header-subtitle">
      <span class="port-name">{{ port_name }}</span>
      <span class="port-code-badge">{{ portCode }}</span>
    </div>
  </div>
  <div class="popover-header" *ngIf="isSurplusAreaSelected">
    <div class="header-title">Surplus Summarys</div>
    <div class="header-subtitle">
      <span class="port-name">{{ port_name }}</span>
      <span class="port-code-badge">{{ portCode }}</span>
    </div>
  </div>
  <div class="popover-header" *ngIf="isDeficitAreaSelected">
    <div class="header-title">Deficit Summary</div>
    <div class="header-subtitle">
      <span class="port-name">{{ port_name }}</span>
      <span class="port-code-badge">{{ portCode }}</span>
    </div>
  </div>

  <!-- Combined View (Both Surplus & Deficit) -->
  <div *ngIf="!isSurplusAreaSelected && !isDeficitAreaSelected" class="data-grid">
    <!-- Divider -->
    <div class="section-divider"></div>

    <!-- Left Column (Surplus) -->
    <div class="data-section">
      <div class="info-row grid-row">
        <span class="label">SURPLUS</span>
        <div class="value surplus-highlight">
          <ng-container *ngIf="surplusCount !== null; else displayPercentage">
            {{ surplusCount | number:'1.0-0' }}
          </ng-container>
          <ng-template #displayPercentage>
            {{ surplusPercentage | number:'1.0-0' }} %
          </ng-template>
          <svg width="10" height="10" viewBox="0 0 10 10">
            <polygon points="5 0, 10 10, 0 10" fill="#10B981" />
          </svg>
        </div>
      </div>

      <div class="info-row grid-row">
        <span class="label">Type</span>
        <select class="modern-select" [(ngModel)]="surpluscontainerType" (change)="onDropdownChange()">
          <option [ngValue]="null" selected>Select Type</option>
          <option *ngFor="let item of uniqueSurplusContainerTypes" [value]="item">{{ item }}</option>
        </select>
      </div>

      <div class="info-row grid-row">
        <span class="label">Size</span>
        <select class="modern-select" [(ngModel)]="surpluscontainerSize" (change)="onDropdownChange()">
          <option [ngValue]="null" selected>Select Size</option>
          <option *ngFor="let size of uniqueContainerSizes" [value]="size">{{ size }}</option>
        </select>
      </div>

      <div class="info-row grid-row">
        <span class="label">EMPTY ACTUAL</span>
        <span class="value">600</span>
      </div>
    </div>

    <!-- Right Column (Deficit) -->
    <div class="data-section">
      <div class="info-row grid-row">
        <span class="label">DEFICIT</span>
        <div class="value deficit-highlight">
          <ng-container *ngIf="deficitCount !== null; else displayDeficitPercentage">
            {{ deficitCount | number:'1.0-0' }}
          </ng-container>
          <ng-template #displayDeficitPercentage>
            {{ deficitPercentage | number:'1.0-0' }} %
          </ng-template>
          <svg width="10" height="10" viewBox="0 0 10 10">
            <polygon points="0 0, 10 0, 5 10" fill="#EF4444" />
          </svg>
        </div>
      </div>

      <div class="info-row grid-row">
        <span class="label">Type</span>
        <select class="modern-select" [(ngModel)]="deifcitcontainerType" (change)="ondeficitDropdownChange()">
          <option [ngValue]="null" selected>Select Type</option>
          <option *ngFor="let item of uniqueDeficitContainerTypes" [value]="item">{{ item }}</option>
        </select>
      </div>

      <div class="info-row grid-row">
        <span class="label">Size</span>
        <select class="modern-select" [(ngModel)]="deficitcontainerSize" (change)="ondeficitDropdownChange()">
          <option [ngValue]="null" selected>Select Size</option>
          <option *ngFor="let size of uniqueDeficitContainerSizes" [value]="size">{{ size }}</option>
        </select>
      </div>

      <div class="info-row grid-row">
        <span class="label">EMPTY ACTUAL</span>
        <span class="value">600</span>
      </div>
    </div>
  </div>

  <!-- Surplus Only View -->
  <div *ngIf="isSurplusAreaSelected" class="data-section single-view">
    <div class="info-row grid-row">
      <span class="label">SURPLUS</span>
      <div class="value surplus-highlight">
        <span *ngIf="container_types && container_size">{{ totalSurplus | number:'1.0-0' }}</span>
        <span *ngIf="!container_types || !container_size">
          {{ getSurplusValueForPortCode(portCode) | number:'1.0-0' }}
        </span>
        <svg width="10" height="10" viewBox="0 0 10 10">
          <polygon points="5 0, 10 10, 0 10" fill="#10B981" />
        </svg>
      </div>
    </div>

    <div class="info-row grid-row">
      <span class="label">Type</span>
      <select class="modern-select" [(ngModel)]="container_types" (ngModelChange)="onSelectionChange()">
        <option [ngValue]="null" selected>Select Type</option>
        <option *ngFor="let item of filteredContainerTypes" [value]="item">{{ item }}</option>
      </select>
    </div>

    <div class="info-row grid-row">
      <span class="label">Size</span>
      <select class="modern-select" [(ngModel)]="container_size" (ngModelChange)="onSelectionChange()">
        <option [ngValue]="null" selected>Select Size</option>
        <option *ngFor="let size of filteredContainerSizes" [value]="size">{{ size }}</option>
      </select>
    </div>

    <div class="info-row grid-row">
      <span class="label">EMPTY ACTUAL</span>
      <span class="value">600</span>
    </div>
  </div>

  <!-- Deficit Only View -->
  <div *ngIf="isDeficitAreaSelected" class="data-section single-view">
    <div class="info-row grid-row">
      <span class="label">DEFICIT</span>
      <div class="value deficit-highlight">
        <span *ngIf="deifcit_Type && deficit_Size">{{ totalDeficit | number:'1.0-0' }}</span>
        <span *ngIf="!deifcit_Type || !deficit_Size">
          {{ getDeficitValueForPortCode(portCode) | number:'1.0-0' }}
        </span>
        <svg width="10" height="10" viewBox="0 0 10 10">
          <polygon points="0 0, 10 0, 5 10" fill="#EF4444" />
        </svg>
      </div>
    </div>

    <div class="info-row grid-row">
      <span class="label">Type</span>
      <select class="modern-select" [(ngModel)]="deifcit_Type" (ngModelChange)="onDeficitChange()">
        <option [ngValue]="null" selected>Select Type</option>
        <option *ngFor="let item of filteredDeficitTypes" [value]="item">{{ item }}</option>
      </select>
    </div>

    <div class="info-row grid-row">
      <span class="label">Size</span>
      <select class="modern-select" [(ngModel)]="deficit_Size" (ngModelChange)="onDeficitChange()">
        <option [ngValue]="null" selected>Select Size</option>
        <option *ngFor="let size of filteredDeficitSizes" [value]="size">{{ size }}</option>
      </select>
    </div>

    <div class="info-row grid-row">
      <span class="label">EMPTY ACTUAL</span>
      <span class="value">600</span>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button class="btn-ghost" routerLink="/view-other-ads">Search ads</button>
    <button class="btn-ghost" (click)="DisplayPostForm()">Post Ad</button>
    <button class="btn-primary" routerLink="/optimized-view" (click)="onOptimizedViewButtonClick()"
      [ngClass]="{'disabled': !isOptimizedViewEnabled()}">
      Optimized View
    </button>
  </div>
</div>