<!-- Loading State -->
<div *ngIf="loading" class="loading-container">
  <div class="loading-bar"></div>
</div>

<!-- Header & Controls -->
<div class="glass-header">
  <h1 class="page-title">Optimized View</h1>

  <div class="controls-area">
    <!-- Port Selector -->
    <div class="filter-group">
      <label class="filter-label">Port</label>
      <select #portSelect class="modern-select" (change)="onPortSelected(portSelect.value)">
        <option selected>Select Port</option>
        <option *ngFor="let port of port_list" [value]="port.port_name">{{ port.port_name }}</option>
      </select>
    </div>

    <!-- Actions -->
    <button routerLink="/carrier-service" class="btn-secondary">
      Carrier Services
    </button>

    <button (click)="onExportClick()" class="btn-secondary">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="text-blue-600">
        <path
          d="M13 12V14H3V12H2V14L2.0038 13.9976C2.00333 14.1288 2.02873 14.2589 2.07854 14.3803C2.12836 14.5017 2.20163 14.6121 2.29414 14.7052C2.38666 14.7983 2.49662 14.8723 2.61774 14.9229C2.73885 14.9734 2.86875 14.9997 3 15H13C13.2652 15 13.5196 14.8946 13.7071 14.7071C13.8946 14.5196 14 14.2652 14 14V12H13Z"
          fill="currentColor" />
        <path d="M3 6L3.7055 6.7025L7.5 2.9125V12H8.5V2.9125L12.2955 6.7025L13 6L8 1L3 6Z" fill="currentColor" />
      </svg>
      Export Data
    </button>

    <button class="btn-primary">
      Sync Data
    </button>
  </div>
</div>

<div class="content-area">
  <ng-container *ngIf="!loading">
    <!-- Partial Surplus Message -->
    <div class="status-card" *ngIf="partialSurplusMessage" role="alert">
      <p class="status-message">{{ partialSurplusMessage }}</p>
      <div class="status-actions">
        <button class="btn-primary" routerLink="/view-other-ads" (click)="searchAds()">Search Ads</button>
      </div>
    </div>

    <!-- Available Services (Group Data) -->
    <div *ngIf="groupeData && !partialSurplusMessage">
      <div *ngFor="let serviceId of getFinalServiceDataKeys()">
        <div *ngIf="(groupeData[serviceId]?.portSequences?.length || 0) > 0" class="service-info">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="mr-2" stroke="currentColor"
            stroke-width="2">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          Available Service: {{ groupeData[serviceId]?.serviceName }}
        </div>
      </div>
    </div>

    <!-- No Service Available (Deficit) -->
    <div class="status-card"
      *ngIf="showNoDeficitAvailableMessage && receiveddeficitcontainerType && receiveddeficitcontainerSize && !partialSurplusMessage">
      <p class="status-message">No service available for this route.</p>
      <div class="status-actions">
        <button class="btn-primary" routerLink="/view-other-ads" (click)="searchAds()">Search Ads</button>
      </div>
    </div>
  </ng-container>

  <!-- Surplus Group Data -->
  <ng-container *ngIf="groupedsurplus">
    <div *ngFor="let serviceId of getFinalSurplusDataKeys()">
      <div *ngIf="(groupedsurplus[serviceId]?.portSequences?.length || 0) > 0" class="service-info">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="mr-2" stroke="currentColor" stroke-width="2">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        Available Service: {{ groupedsurplus[serviceId]?.serviceName }}
      </div>
    </div>
  </ng-container>

  <!-- No Service Available (Surplus) -->
  <div class="status-card"
    *ngIf="showNoServiceAvailableMessage && receivedsurpluscontainerType && receivedsurpluscontainerSize">
    <p class="status-message">No service available.</p>
  </div>

  <!-- Port Not Available -->
  <div class="status-card" *ngIf="!portseq_no && !loading">
    <p class="status-message">Port not available in any service route.</p>
  </div>

  <!-- Map Container -->
  <div class="map-container">
    <div #mapElement style="height: 100%; width: 100%;"></div>
  </div>

  <!-- Back Button -->
  <div class="back-button-container">
    <button (click)="goback()" class="btn-back">
      ‚Üê Go Back
    </button>
  </div>
</div>